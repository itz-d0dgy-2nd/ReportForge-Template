<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <!-- Template CSS-->
        <link rel="stylesheet" href="{{ .Path }}/0_report_template/html/styles/template.css">
        <link rel="stylesheet" href="{{ .Path }}/0_report_template/html/styles/severity-matrix.css">
        <link rel="stylesheet" href="{{ .Path }}/0_report_template/html/styles/severity-bar-graph.css">
        <link rel="stylesheet" href="{{ .Path }}/0_report_template/html/styles/custom.css">

        <!-- Template JS-->
        <script rel="javascript" src="{{ .Path }}/0_report_template/html/scripts/template.js"></script>

        <!-- Google Fonts -->
        <link rel="stylesheet" href="{{ .Path }}/0_report_template/html/styles/exo2/font-exo2.css">
        <link rel="stylesheet" href="{{ .Path }}/0_report_template/html/styles/helvetica-neue/font-helvetica-neue.css">

        <!-- Prism.js Core -->
        <link rel="stylesheet" href="{{ .Path }}/0_report_template/html/styles/prismjs/prism-tomorrow.min.css">
        <script rel="javascript" src="{{ .Path }}/0_report_template/html/scripts/prismjs/prism.min.js"></script>
        <script rel="javascript" src="{{ .Path }}/0_report_template/html/scripts/prismjs/prism-markup.min.js"></script>
        <script rel="javascript" src="{{ .Path }}/0_report_template/html/scripts/prismjs/prism-markup-templating.min.js"></script>
        <script rel="javascript" src="{{ .Path }}/0_report_template/html/scripts/prismjs/prism-php.min.js"></script>
        <script rel="javascript" src="{{ .Path }}/0_report_template/html/scripts/prismjs/prism-go.min.js"></script>
        <script rel="javascript" src="{{ .Path }}/0_report_template/html/scripts/prismjs/prism-python.min.js"></script>
        <script rel="javascript" src="{{ .Path }}/0_report_template/html/scripts/prismjs/prism-csharp.min.js"></script>
        
    <title>{{ .MetadataConfig.TargetInformation.TargetName }} - {{ .MetadataConfig.TargetInformation.TargetTest }}</title>
    </head>

    <body>
        <a href="#main-content" class="skip-link" aria-label="Skip to main content">Skip to main content</a>
        <main role="main" id="main-content">
            {{- template "metadata" . }}
            {{- template "table-of-contents" . }}
            {{- template "document-information" . }}
            {{- template "summaries" . }}
            {{- template "table-of-findings" . }}
            {{- template "severity-matrix" . }}
            {{- template "severity-bar-graph" . }}
            {{- template "findings" . }}
            {{- template "suggestions" . }}
            {{- template "appendices" . }}
            {{- template "document-status-indicator" . }}
        </main>
    </body>
</html>

<!-- Metadata Template -->
{{- define "metadata" }}
{{- if .MetadataConfig }}
<section id="metadata" class="metadata-section" aria-labelledby="metadata-heading">
    <article>
        <h1 id="metadata-heading">{{ .MetadataConfig.TargetInformation.TargetName }}</h1>
        <h2>{{ .MetadataConfig.TargetInformation.TargetTest }}</h2>
        <table aria-label="Document metadata">
            <tbody>
                <tr><th scope="row">Client:</th><td>{{ .MetadataConfig.Client }}</td></tr>
                {{- range .MetadataConfig.DocumentInformation }}
                {{- if .DocumentCurrent }}
                <tr><th scope="row">Document Status:</th><td>{{ .DocumentVersioning.DocumentStatus }}</td></tr>
                <tr><th scope="row">Document Version:</th><td>{{ .DocumentVersioning.DocumentVersion }}</td></tr>
                <tr><th scope="row">Document Date:</th><td>{{ .DocumentVersioning.DocumentDate }}</td></tr>
                <tr><th scope="row">Document Stage:</th><td>{{ .DocumentVersioning.DocumentStage }}</td></tr>
                {{- end }}
                {{- end }}
            </tbody>
        </table>
    </article>
    <div class="front-page"></div>
    <div class="overlay-image"></div>
    <div class="page-break"></div>
</section>
{{- end }}
{{- end }}

<!-- Table of Contents Template -->
{{- define "table-of-contents" }}
{{- if .MetadataConfig }}
<section id="table-of-contents" class="table-of-contents-section" aria-labelledby="table-of-contents-heading">
    <h1 id="table-of-contents-heading">Table of Contents</h1>
    <nav role="navigation">
        <ul>
            {{- if .MetadataConfig.DocumentInformation }}
            <li><a href="#document-information" aria-label="Navigate to Document Information">Document Information</a></li>
            {{- end }}
            {{- if .Summaries }}
            {{- range .Summaries }}
            <li><a href="#summaries-{{ .Headers.ReportSummaryName }}" aria-label="Navigate to {{ .Headers.ReportSummaryName }} summary">{{ .Headers.ReportSummaryTitle }}</a></li>
            {{- end }}
            {{- end }}
            {{- if .Findings }}
            <li><a href="#table-of-findings" aria-label="Navigate to Findings Table">Findings Table</a></li>
            {{- end }}
            {{- if .SeverityConfig }}
                {{- if .SeverityConfig.ConductSeverityAssessment }}<li><a href="#severity-matrix" aria-label="Navigate to Severity Matrix">Severity Matrix</a></li>{{ end }}
                {{- if .SeverityConfig.DisplaySeverityBarGraph }}<li><a href="#severity-bar-graph" aria-label="Navigate to Severity Bar Graph">Severity Bar Graph</a></li>{{ end }}
            {{- end }}
            {{- if .Findings }}
            {{- $lastDirectory := "" }}
            {{- range .Findings }}
            {{- if ne .Directory $lastDirectory }}
            <li><a href="#findings-{{ .Directory }}" aria-label="Navigate to {{ .Directory }} Findings">Findings - {{ .Directory }}</a></li>
            {{- $lastDirectory = .Directory }}
            {{- end }}
            {{- end }}
            {{- end }}
            {{- if .Suggestions }}
            {{- $lastDirectory := "" }}
            {{- range .Suggestions }}
            {{- if ne .Directory $lastDirectory }}
            <li><a href="#suggestions-{{ .Directory }}" aria-label="Navigate to {{ .Directory }} Suggestions">Suggestions - {{ .Directory }}</a></li>
            {{- $lastDirectory = .Directory }}
            {{- end }}
            {{- end }}
            {{- end }}
            {{- if .Appendices }}
            {{- $lastDirectory := "" }}
            {{- range .Appendices }}
            {{- if ne .Directory $lastDirectory }}
            <li><a href="#appendices-{{ .Directory }}" aria-label="Navigate to {{ .Directory }} Appendices">Appendices - {{ .Directory }}</a></li>
            {{- $lastDirectory = .Directory }}
            {{- end }}
            {{- end }}
            {{- end }}
        </ul>
    </nav>
    <div class="page-break"></div>
</section>
{{- end }}
{{- end }}

<!-- Document Information Template -->
{{- define "document-information" }}
{{- if .MetadataConfig }}
<section id="document-information" class="document-information-section" aria-labelledby="document-information">
    <h1 id="document-information-heading">Document Information</h1>
    <h2>Document Versioning</h2>
    <table role="table" aria-label="Information Table - Complete">
        <thead>
            <tr>
                <th scope="col">Status</th>
                <th scope="col">Version</th>
                <th scope="col">Date</th>
                <th scope="col">Stage</th>
                <th scope="col">Contributor</th>
            </tr>
        </thead>
        <tbody>
            {{- range .MetadataConfig.DocumentInformation }}
            <tr>
                <td>{{ .DocumentVersioning.DocumentStatus }}</td>
                <td>{{ .DocumentVersioning.DocumentVersion }}</td>
                <td>{{ .DocumentVersioning.DocumentDate }}</td>
                <td>{{ .DocumentVersioning.DocumentStage }}</td>
                <td>{{ .DocumentVersioning.DocumentContributor }}</td>
            </tr>
            {{- end }}
        </tbody>
    </table>
    <h2>Document Stakeholders</h2>
    <table role="table" aria-label="Stakeholders Table">
        <thead>
            <tr>
                <th scope="col">Name</th>
                <th scope="col">Company</th>
                <th scope="col">Role</th>
            </tr>
        </thead>
        <tbody>
            {{- range .MetadataConfig.StakeholderInformation }}
            <tr>
                <td>{{ .StakeholderName }}</td>
                <td>{{- if .StakeholderCompany }}{{- if ne .StakeholderCompany $.MetadataConfig.Client }}{{ .StakeholderCompany }}{{- else }}{{ $.MetadataConfig.Client }}{{- end }}{{- else }}{{ $.MetadataConfig.Client }}{{- end }}</td>
                <td>{{ .StakeholderRole }}</td>
            </tr>
            {{- end }}
        </tbody>
    </table>
    <div class="page-break"></div>
</section>
{{- end }}
{{- end }}

<!-- Summaries Template -->
{{- define "summaries" }}
{{- if .Summaries }}
<section id="summaries" class="summaries-section" aria-labelledby="summaries-heading">
    <h1 id="summaries-heading">Report Summaries</h1>
    {{- range .Summaries }}
    <article id="summaries-{{ .Headers.ReportSummaryName }}" class="summary" aria-labelledby="{{ .Headers.ReportSummaryName }}-heading">
        <h2 id="{{ .Headers.ReportSummaryName }}-heading">{{ .Headers.ReportSummaryTitle }}</h2>
        {{ .Body }}
    </article>
    <div class="page-break"></div>
    {{- end }}
</section>
{{- end }}
{{- end }}

<!-- Summary Table Template -->
{{- define "table-of-findings" }}
{{- if .Findings }}
<section id="table-of-findings" class="table-of-findings-section" aria-label="Table of Findings">
    <h1>Findings Table</h1> 
    <table role="table">
        <thead>
            <tr>
                <th scope="col">Finding ID</th>
                <th scope="col">Finding Name</th>
                <th scope="col">Finding Status</th>
                <th scope="col">Finding Severity</th>
            </tr>
        </thead>
        <tbody>
            {{- range .Findings }}
            <tr>
                <td><a href="#{{ .Headers.FindingName }}" aria-label="Navigate to detailed finding {{ .Headers.FindingID }}">{{ .Headers.FindingID }}</a></td>
                <td class="finding-name">{{ .Headers.FindingTitle }}</td>
                <td class="finding-status" data-status="{{ .Headers.FindingStatus }}">{{ .Headers.FindingStatus }}</td>
                <td class="finding-severity" data-severity="{{ .Headers.FindingSeverity }}"> {{ .Headers.FindingSeverity }} </td>
            </tr>
            {{- end }}
        </tbody>
    </table>
    <div class="page-break"></div>
</section>
{{- end }}
{{- end }}

<!-- Severity Matrix Template -->
{{- define "severity-matrix" }}
{{- if .SeverityConfig.ConductSeverityAssessment }}
<section id="severity-matrix" class="severity-matrix-section" aria-label="Severity Matrix">
    <h1>Findings Severity Matrix</h1> 
    <table role="table" aria-label="Severity Matrix Table">
        <thead>
            <tr>
                <th scope="col"></th>
                {{- if $.SeverityConfig.FlipSeverityMatrix }}
                    {{- range .SeverityConfig.Impacts }}<th scope="col">{{ . }}</th>{{- end }}
                {{- else }}
                    {{- range .SeverityConfig.Likelihoods }}<th scope="col">{{ . }}</th>{{- end }}
                {{- end }}
            </tr>
        </thead>
        <tbody>
            {{- range $rowIndex, $intersections := .SeverityMatrix.Matrix }}
            <tr>
                <th scope="row">
                    {{- if $.SeverityConfig.FlipSeverityMatrix }}
                        {{- index $.SeverityConfig.Likelihoods $rowIndex }}
                    {{- else }}
                        {{- index $.SeverityConfig.Impacts $rowIndex }}
                    {{- end -}}
                </th>
                {{- range $columnIndex, $intersectionString := $intersections }}
                <td class="finding-severity" data-severity="{{ index (index $.SeverityConfig.CalculatedMatrix $rowIndex) $columnIndex }}">
                    {{- $ids := split $intersectionString ", " -}}
                    {{- range $id := $ids -}}
                    {{- range $.Findings -}}
                        {{- if eq .Headers.FindingID $id -}}
                        <a href="#{{ .Headers.FindingName }}">{{ $id }}</a>
                        {{- end -}}
                    {{- end -}}
                    {{- end -}}
                </td>
                {{- end }}
            </tr>
            {{- end }}
        </tbody>
    </table>
    <div class="page-break"></div>
</section>
{{- end }}
{{- end }}

<!-- Severity Bar Graph Template -->
{{- define "severity-bar-graph" }}
{{- if .SeverityConfig.DisplaySeverityBarGraph }}
<section id="severity-bar-graph" class="severity-graph-section" aria-label="Severity Bar Graph">
    <h1>Findings Severity Bar Graph</h1>
    <div class="bar-graph-vertical">
        <div class="bar-container-vertical">
            <meter class="bar finding-severity" data-severity="Low" value="{{ .SeverityBarGraph.Low }}" max="{{ .SeverityBarGraph.Total }}" aria-label="Low severity: {{ .SeverityBarGraph.Low }} of {{ .SeverityBarGraph.Total }} findings"></meter>
            <span class="label">Low {{ .SeverityBarGraph.Low }}/{{ .SeverityBarGraph.Total }}</span>
        </div>
        <div class="bar-container-vertical">
            <meter class="bar finding-severity" data-severity="Medium" value="{{ .SeverityBarGraph.Medium }}" max="{{ .SeverityBarGraph.Total }}" aria-label="Medium severity: {{ .SeverityBarGraph.Medium }} of {{ .SeverityBarGraph.Total }} findings"></meter>
            <span class="label">Medium {{ .SeverityBarGraph.Medium }}/{{ .SeverityBarGraph.Total }}</span>
        </div>
        <div class="bar-container-vertical">
            <meter class="bar finding-severity" data-severity="High" value="{{ .SeverityBarGraph.High }}" max="{{ .SeverityBarGraph.Total }}" aria-label="High severity: {{ .SeverityBarGraph.High }} of {{ .SeverityBarGraph.Total }} findings"></meter>
            <span class="label">High {{ .SeverityBarGraph.High }}/{{ .SeverityBarGraph.Total }}</span>
        </div>
        <div class="bar-container-vertical">
            <meter class="bar finding-severity" data-severity="Critical" value="{{ .SeverityBarGraph.Critical }}" max="{{ .SeverityBarGraph.Total }}" aria-label="Critical severity: {{ .SeverityBarGraph.Critical }} of {{ .SeverityBarGraph.Total }} findings"></meter>
            <span class="label">Critical {{ .SeverityBarGraph.Critical }}/{{ .SeverityBarGraph.Total }}</span>
        </div>
    </div>
    <div class="page-break"></div>
</section>
{{- end }}
{{- end }}

<!-- Findings Template -->
{{- define "findings" }}
{{- if .Findings }}
<section id="findings" class="findings-section" aria-labelledby="findings-heading">
    <h1 id="findings-heading">Findings</h1>
    
    {{- $lastDirectory := "" }}
    {{- range .Findings }}
        {{- if ne .Directory $lastDirectory }}
            {{- if ne $lastDirectory "" }}</section>{{- end }}
    <section id="findings-{{ .Directory }}" class="findings-directory" aria-labelledby="findings-{{ .Directory }}-heading">
        <h2 id="findings-{{ .Directory }}-heading">{{ .Directory }} Findings</h2>
        {{- end }}
        
        <article id="{{ .Headers.FindingName }}" class="finding" aria-labelledby="{{ .Headers.FindingName }}-heading">
            <h3 id="{{ .Headers.FindingName }}-heading">{{ .Headers.FindingID }} - {{ .Headers.FindingTitle }}</h3>
            <table aria-label="Finding details for {{ .Headers.FindingTitle }}">
                <thead>
                    <tr>
                        <th scope="col">Finding Status</th>
                        {{- if $.SeverityConfig.ConductSeverityAssessment }}
                        <th scope="col">Finding Impact</th>
                        <th scope="col">Finding Likelihood</th>
                        {{- end }}
                        <th scope="col">Finding Severity</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td class="finding-status" data-status="{{ .Headers.FindingStatus }}">{{ .Headers.FindingStatus }}</td>
                        {{- if $.SeverityConfig.ConductSeverityAssessment }}
                        <td>{{ .Headers.FindingImpact }}</td>
                        <td>{{ .Headers.FindingLikelihood }}</td>
                        {{- end }}
                        <td class="finding-severity" data-severity="{{ .Headers.FindingSeverity }}">{{ .Headers.FindingSeverity }}</td>
                    </tr>
                </tbody>
            </table>
            {{ .Body }}
        </article>
        <div class="page-break"></div>
        {{- $lastDirectory = .Directory }}
    {{- end }}
    </section>
</section>
{{- end }}
{{- end }}

<!-- Suggestions Template -->
{{- define "suggestions" }}
{{- if .Suggestions }}
<section id="suggestions" class="suggestions-section" aria-labelledby="suggestions-heading">
    <h1 id="suggestions-heading">Suggestions</h1>
    
    {{- $lastDirectory := "" }}
    {{- range .Suggestions }}
        {{- if ne .Directory $lastDirectory }}
            {{- if ne $lastDirectory "" }}</section>{{- end }}
    <section id="suggestions-{{ .Directory }}" class="suggestions-directory" aria-labelledby="suggestions-{{ .Directory }}-heading">
        <h2 id="suggestions-{{ .Directory }}-heading">{{ .Directory }} Suggestions</h2>
        {{- end }}
        <article id="{{ .Headers.SuggestionName }}" class="suggestion" aria-labelledby="{{ .Headers.SuggestionName }}-heading">
            <h3 id="{{ .Headers.SuggestionName }}-heading">{{ .Headers.SuggestionID }} - {{ .Headers.SuggestionTitle }}</h3>
            {{ .Body }}
        </article>
        <div class="page-break"></div>
        {{- $lastDirectory = .Directory }}
    {{- end }}
    </section>
</section>
{{- end }}
{{- end }}

<!-- Appendices Template -->
{{- define "appendices" }}
{{- if .Appendices }}
<section id="appendices" class="appendices-section" aria-labelledby="appendices-heading">
    <h1 id="appendices-heading">Appendices</h1>
    {{- $lastDirectory := "" }}
    {{- range .Appendices }}
        {{- if ne .Directory $lastDirectory }}
            {{- if ne $lastDirectory "" }}</section>{{- end }}
    <section id="appendices-{{ .Directory }}" class="appendices-directory" aria-labelledby="appendices-{{ .Directory }}-heading">
        <h2 id="appendices-{{ .Directory }}-heading">{{ .Directory }} Appendices</h2>
        {{- end }}
        <article id="{{ .Headers.AppendixName }}" class="appendix" aria-labelledby="{{ .Headers.AppendixName }}-heading">
            <h3 id="{{ .Headers.AppendixName }}-heading">{{ .Headers.AppendixTitle }}</h3>
            {{ .Body }}
        </article>
        <div class="page-break"></div>
        {{- $lastDirectory = .Directory }}
    {{- end }}
    </section>
</section>
{{- end }}
{{- end }}

<!-- Document Status Indicator Template -->
{{- define "document-status-indicator" }}
{{- if .MetadataConfig }}
{{- range .MetadataConfig.DocumentInformation }}
{{- if .DocumentCurrent }}
{{- if eq .DocumentVersioning.DocumentStatus "Draft" }}
<p class="AE3CEE3B46BEBFFE161D55F7AF5F97F1"></p>
{{- end }}
{{- end }}
{{- end }}
{{- end }}
{{- end }}
